module euler_rho_rhou_p_ev_phi_grid_transform_trafos

  use parameter

  private

  public give_T, give_c, give_r, give_u, give_p

contains

!!!=================================================================================================
  function give_T(q) result(T)
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    real(kind=rk), dimension(:,:,:,:), intent(in)           :: q
    real(kind=rk), dimension(size(q,1),size(q,2),size(q,3)) :: T
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    real(kind=rk)                                           :: W
    real(kind=rk), save                                     :: W_INV_R
    logical      , save                                     :: get_w_inv_r = .true.
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

    if(get_w_inv_r.eqv..true.) then
       ! get mol weight
       ! default: air (source: Baehr, H. D., "Thermodynamik, 7.edition" (1989) (page 207)
       call get_parameter(W,'material.W',default=0.0289647_rk)

       ! compute W_INV_R
       W_INV_R = W/params%material%R

       ! save state
       get_w_inv_r = .false.
    end if

    T = W_INV_R*q(:,:,:,5)/q(:,:,:,1)

  end function give_T
!!!=================================================================================================

!!!=================================================================================================
  function give_c(q) result(c)
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    real(kind=rk), dimension(:,:,:,:), intent(in)           :: q
    real(kind=rk), dimension(size(q,1),size(q,2),size(q,3)) :: c
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    real(kind=rk)                                           :: gamma
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

    gamma = params%material%gamma

    c = sqrt(gamma*q(:,:,:,5)/q(:,:,:,1))

  end function give_c
!!!=================================================================================================

!!!=================================================================================================
  function give_r(q) result(rho)
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    real(kind=rk), dimension(:,:,:,:), intent(in)           :: q
    real(kind=rk), dimension(size(q,1),size(q,2),size(q,3)) :: rho
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

    rho = q(:,:,:,1)

  end function give_r
!!!=================================================================================================

!!!=================================================================================================
  function give_p(q) result(p)
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    real(kind=rk), dimension(:,:,:,:), intent(in)           :: q
    real(kind=rk), dimension(size(q,1),size(q,2),size(q,3)) :: p
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

    p = q(:,:,:,5)

  end function give_p
!!!=================================================================================================

!!!=================================================================================================
  function give_u(q) result(u)
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    real(kind=rk), dimension(:,:,:,:), intent(in)               :: q
    real(kind=rk), dimension(size(q,1),size(q,2),size(q,3),3)   :: u
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    integer                                                     :: i
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

    do i = 1,3
       u(:,:,:,i) = q(:,:,:,i+1)/q(:,:,:,1)
    end do

  end function give_u
!!!=================================================================================================

end module euler_rho_rhou_p_ev_phi_grid_transform_trafos
